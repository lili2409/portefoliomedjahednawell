<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veille Documentaire ‚Äî Synchronis√©e</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg,#0f172a,#1e293b); 
      color:#e2e8f0; 
      min-height: 100vh;
    }
    
    .section-title { 
      font-weight:800; 
      font-size:2rem;
      background: linear-gradient(90deg,#38bdf8,#818cf8); 
      -webkit-background-clip:text; 
      color:transparent; 
    }
    
    .card-admin { 
      background: #1e293b; 
      border-radius: 16px; 
      border: 1px solid #334155; 
      box-shadow: 0 12px 35px rgba(0,0,0,0.25);
      margin-bottom: 2rem;
    }
    
    .badge-key { 
      background:#818cf8; 
      padding:4px 8px; 
      border-radius:8px; 
      font-size:0.75rem; 
      margin: 2px;
      color:#fff; 
      display: inline-block;
    }
    
    .table-container { 
      background:#ffffff; 
      border-radius:16px; 
      padding:20px; 
      box-shadow:0 12px 35px rgba(0,0,0,0.15); 
      color:#0f172a;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-share"></i> Veille Synchronis√©e
      </a>
      <div>
        <button class="btn btn-outline-warning btn-sm me-2" onclick="generateShareableFile()">
          <i class="bi bi-download"></i> G√©n√©rer fichier partageable
        </button>
        <button class="btn btn-outline-info btn-sm" onclick="loadSharedFile()">
          <i class="bi bi-upload"></i> Charger fichier partag√©
        </button>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h1 class="section-title text-center mb-4">üìö Veille Documentaire ‚Äî Synchronis√©e</h1>
    
    <!-- Instructions -->
    <div class="card-admin p-4 mb-4">
      <h4><i class="bi bi-info-circle"></i> Comment synchroniser entre plusieurs personnes ?</h4>
      
      <div class="row mt-3">
        <div class="col-md-6">
          <div class="p-3 border rounded mb-3">
            <h5><i class="bi bi-person-check"></i> Pour partager VOS articles :</h5>
            <ol>
              <li>Ajoutez/modifiez vos articles</li>
              <li>Cliquez sur <strong>"G√©n√©rer fichier partageable"</strong></li>
              <li>Envoyez le fichier HTML par email/Drive</li>
            </ol>
            <button class="btn btn-warning w-100" onclick="generateShareableFile()">
              <i class="bi bi-download"></i> G√©n√©rer fichier
            </button>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="p-3 border rounded mb-3">
            <h5><i class="bi bi-people"></i> Pour recevoir des articles :</h5>
            <ol>
              <li>Recevez un fichier HTML d'un coll√®gue</li>
              <li>Cliquez sur <strong>"Charger fichier partag√©"</strong></li>
              <li>S√©lectionnez le fichier re√ßu</li>
              <li>Les articles s'ajouteront aux v√¥tres</li>
            </ol>
            <button class="btn btn-info w-100" onclick="loadSharedFile()">
              <i class="bi bi-upload"></i> Charger fichier
            </button>
          </div>
        </div>
      </div>
      
      <div class="alert alert-info mt-3">
        <i class="bi bi-lightbulb"></i> <strong>Astuce :</strong> D√©signez une personne comme "ma√Ætre" qui g√©n√®re le fichier final que tout le monde utilise.
      </div>
    </div>

    <!-- Interface standard de gestion -->
    <!-- ... (le reste de votre interface) ... -->
  </div>

  <script>
    // DONN√âES COURANTES (locale)
    let articles = [];
    
    // CHARGER depuis localStorage
    function loadLocalData() {
      const saved = localStorage.getItem('veilleData');
      if (saved) {
        articles = JSON.parse(saved);
        displayArticles();
      }
    }
    
    // SAUVEGARDER dans localStorage
    function saveLocalData() {
      localStorage.setItem('veilleData', JSON.stringify(articles));
    }
    
    // G√âN√âRER un fichier HTML PARTAGEABLE
    function generateShareableFile() {
      // Cr√©er un fichier HTML complet avec les donn√©es int√©gr√©es
      const htmlContent = `
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veille Documentaire Partag√©e ‚Äî ${new Date().toLocaleDateString('fr-FR')}</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg,#0f172a,#1e293b); 
      color:#e2e8f0; 
      min-height: 100vh;
    }
    
    .section-title { 
      font-weight:800; 
      font-size:2rem;
      background: linear-gradient(90deg,#38bdf8,#818cf8); 
      -webkit-background-clip:text; 
      color:transparent; 
    }
    
    .table-container { 
      background:#ffffff; 
      border-radius:16px; 
      padding:20px; 
      box-shadow:0 12px 35px rgba(0,0,0,0.15); 
      color:#0f172a;
      overflow: hidden;
    }
    
    .badge-key { 
      background:#818cf8; 
      padding:4px 8px; 
      border-radius:8px; 
      font-size:0.75rem; 
      margin: 2px;
      color:#fff; 
      display: inline-block;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-share"></i> Veille Documentaire Partag√©e
      </a>
      <div class="text-light">
        ${articles.length} articles | ${new Date().toLocaleDateString('fr-FR')}
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h1 class="section-title text-center mb-4">üìö Veille Documentaire Partag√©e</h1>
    
    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-bordered align-middle">
          <thead>
            <tr>
              <th>Date</th>
              <th>Titre</th>
              <th>Source</th>
              <th>Mots-cl√©s</th>
              <th>R√©sum√©</th>
              <th>Pays</th>
            </tr>
          </thead>
          <tbody id="articlesList">
            ${articles.map(article => `
              <tr>
                <td><strong>${article.date}</strong></td>
                <td>
                  <strong>${article.titre}</strong><br>
                  <small class="text-muted">${article.source}</small>
                </td>
                <td>${article.source}</td>
                <td>
                  ${article.motscles.split(',').map(t => 
                    `<span class="badge-key">${t.trim()}</span>`
                  ).join(' ')}
                </td>
                <td>${article.resume}</td>
                <td>${article.pays || 'International'}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
      
      <div class="text-center mt-4">
        <p class="text-muted">
          Fichier g√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')} √† ${new Date().toLocaleTimeString('fr-FR')}<br>
          ${articles.length} articles
        </p>
      </div>
    </div>
  </div>
</body>
</html>
      `;
      
      // T√©l√©charger le fichier
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `veille-partagee-${new Date().toISOString().split('T')[0]}.html`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert(`Fichier g√©n√©r√© avec ${articles.length} articles !\nPartagez ce fichier avec vos coll√®gues.`);
    }
    
    // CHARGER un fichier partag√©
    function loadSharedFile() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.html,.txt,.json';
      
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function() {
          // Essayer d'extraire les donn√©es du fichier HTML
          const content = reader.result;
          
          // M√©thode 1 : Chercher du JSON dans le fichier
          const jsonMatch = content.match(/let articles = (\[.*?\])/s);
          
          if (jsonMatch && jsonMatch[1]) {
            try {
              const importedArticles = JSON.parse(jsonMatch[1]);
              
              // Fusionner avec les articles existants (√©viter les doublons)
              importedArticles.forEach(newArticle => {
                // V√©rifier si l'article existe d√©j√†
                const exists = articles.some(existing => 
                  existing.titre === newArticle.titre && 
                  existing.date === newArticle.date
                );
                
                if (!exists) {
                  articles.push(newArticle);
                }
              });
              
              saveLocalData();
              displayArticles();
              
              alert(`${importedArticles.length} articles charg√©s (doublons √©vit√©s)`);
              
            } catch (err) {
              alert('Erreur de parsing JSON : ' + err.message);
            }
          } else {
            // M√©thode 2 : Demander √† l'utilisateur de copier-coller le JSON
            const jsonData = prompt(
              'Impossible d\'extraire automatiquement. ' +
              'Collez les donn√©es JSON manuellement :',
              ''
            );
            
            if (jsonData) {
              try {
                const importedArticles = JSON.parse(jsonData);
                articles = articles.concat(importedArticles);
                saveLocalData();
                displayArticles();
                alert(`${importedArticles.length} articles ajout√©s !`);
              } catch (err) {
                alert('Donn√©es JSON invalides');
              }
            }
          }
        };
        
        reader.readAsText(file);
      };
      
      input.click();
    }
    
    // Solution ALTERNATIVE : Donn√©es dans un fichier JSON s√©par√©
    function setupJSONFileSharing() {
      alert(`Pour une synchronisation facile :

1. Cr√©ez un fichier JSON sur Google Drive/Dropbox
2. Mettez-y vos articles au format JSON
3. Partagez le lien en lecture seule
4. Chacun peut importer depuis ce lien

Format JSON :
[
  {
    "date": "2025-11-15",
    "titre": "...",
    "source": "...",
    "lien": "...",
    "outil": "...",
    "motscles": "...",
    "resume": "...",
    "pays": "..."
  }
]`);
    }
    
    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
      loadLocalData();
      
      // Si pas d'articles, charger les donn√©es par d√©faut
      if (articles.length === 0) {
        articles = [
          // Vos articles par d√©faut...
        ];
        saveLocalData();
      }
      
      displayArticles();
    });
  </script>
</body>
</html>
