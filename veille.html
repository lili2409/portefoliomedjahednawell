<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Veille — Nawell Medjahed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f7f7f9; }
        .card { border-radius: 12px; }
        .table thead th { background: #e9ecef; font-weight: 700; }
    </style>
</head>
<body>

<section class="py-5">
    <div class="container">
        <h2 class="text-center mb-4">Admin Veille Documentaire</h2>
        
        <!-- Connexion -->
        <div id="loginDiv" class="card p-4 mb-4 col-md-6 mx-auto">
            <h5>Connexion admin</h5>
            <input type="password" id="password" class="form-control mb-3" placeholder="Mot de passe">
            <button id="loginBtn" class="btn btn-primary w-100">Se connecter</button>
            <p id="loginError" class="text-danger mt-2" style="display:none;">Mot de passe incorrect</p>
        </div>

        <!-- Interface Admin -->
        <div id="adminInterface" style="display:none;">
            <!-- Formulaire -->
            <div class="card p-4 mb-4">
                <h5 class="mb-3">Ajouter un article</h5>
                <form id="formVeille">
                    <div class="row g-3">
                        <div class="col-md-3"><label>Date</label><input type="date" id="date" class="form-control" required></div>
                        <div class="col-md-6"><label>Titre</label><input type="text" id="titre" class="form-control" required></div>
                        <div class="col-md-3"><label>Pays</label><input type="text" id="pays" class="form-control"></div>
                        <div class="col-md-4"><label>Source</label><input type="text" id="source" class="form-control"></div>
                        <div class="col-md-4"><label>Lien</label><input type="url" id="lien" class="form-control"></div>
                        <div class="col-md-4"><label>Outil utilisé</label><input type="text" id="outil" class="form-control"></div>
                        <div class="col-md-6"><label>Mots-clés</label><input type="text" id="motscles" class="form-control" placeholder="robotique, IA, chirurgie..."></div>
                        <div class="col-md-6"><label>Résumé / Analyse</label><textarea id="resume" class="form-control" rows="2"></textarea></div>
                    </div>
                    <button class="btn btn-primary w-100 mt-3">Ajouter</button>
                </form>
            </div>

            <!-- Tableau des articles -->
            <div class="card p-4">
                <h5 class="mb-3">Articles (${articles.length})</h5>
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>Date</th><th>Titre</th><th>Source</th><th>Actions</th></tr>
                        </thead>
                        <tbody id="tableArticles"></tbody>
                    </table>
                </div>
                <button id="downloadBtn" class="btn btn-success w-100 mt-3">Télécharger veille.json</button>
                <button id="viewBtn" class="btn btn-outline-primary w-100 mt-2" onclick="window.open('veille.html', '_blank')">Voir la page publique</button>
            </div>
        </div>
    </div>
</section>

<script>
const ADMIN_PASSWORD = "Nawell123";
let articles = [];

// Initialisation
document.getElementById('loginBtn').onclick = () => {
    const password = document.getElementById('password').value;
    if (password === ADMIN_PASSWORD) {
        document.getElementById('loginDiv').style.display = 'none';
        document.getElementById('adminInterface').style.display = 'block';
        loadArticles();
    } else {
        document.getElementById('loginError').style.display = 'block';
    }
};

// Charger depuis veille.json
async function loadArticles() {
    try {
        const response = await fetch('veille.json');
        articles = await response.json();
        displayArticles();
    } catch (error) {
        console.log('Fichier veille.json non trouvé, création d\'un tableau vide');
        articles = [];
        displayArticles();
    }
}

// Afficher les articles
function displayArticles() {
    const tbody = document.getElementById('tableArticles');
    tbody.innerHTML = '';
    
    articles.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    articles.forEach((article, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${article.date}</td>
            <td><strong>${article.titre.substring(0, 60)}${article.titre.length > 60 ? '...' : ''}</strong></td>
            <td>${article.source}</td>
            <td>
                <button class="btn btn-sm btn-danger" onclick="deleteArticle(${index})">Supprimer</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
    
    // Mettre à jour le titre
    document.querySelector('#adminInterface h5').textContent = `Articles (${articles.length})`;
}

// Ajouter un article
document.getElementById('formVeille').onsubmit = (e) => {
    e.preventDefault();
    
    const newArticle = {
        date: document.getElementById('date').value,
        titre: document.getElementById('titre').value,
        pays: document.getElementById('pays').value,
        source: document.getElementById('source').value,
        lien: document.getElementById('lien').value,
        outil: document.getElementById('outil').value,
        motscles: document.getElementById('motscles').value,
        resume: document.getElementById('resume').value
    };
    
    articles.push(newArticle);
    displayArticles();
    document.getElementById('formVeille').reset();
    alert('Article ajouté (en local)');
};

// Supprimer un article
function deleteArticle(index) {
    if (confirm('Supprimer cet article ?')) {
        articles.splice(index, 1);
        displayArticles();
    }
}

// Télécharger le JSON
document.getElementById('downloadBtn').onclick = () => {
    const dataStr = JSON.stringify(articles, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'veille.json';
    a.click();
    URL.revokeObjectURL(url);
};

// Définir la date d'aujourd'hui par défaut
document.getElementById('date').valueAsDate = new Date();
</script>

</body>
</html>
