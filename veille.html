<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veille Documentaire ‚Äî Partag√©e</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      background: linear-gradient(135deg,#0f172a,#1e293b); 
      color:#e2e8f0; 
      min-height: 100vh;
    }
    
    .section-title { 
      font-weight:800; 
      font-size:2rem;
      background: linear-gradient(90deg,#38bdf8,#818cf8); 
      -webkit-background-clip:text; 
      color:transparent; 
    }
    
    .card-admin { 
      background: #1e293b; 
      border-radius: 16px; 
      border: 1px solid #334155; 
      box-shadow: 0 12px 35px rgba(0,0,0,0.25);
      margin-bottom: 2rem;
    }
    
    .badge-key { 
      background:#818cf8; 
      padding:4px 8px; 
      border-radius:8px; 
      font-size:0.75rem; 
      margin: 2px;
      color:#fff; 
      display: inline-block;
    }
    
    /* Indicateur de statut */
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 5px;
    }
    
    .status-online { background-color: #10b981; }
    .status-offline { background-color: #ef4444; }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-share"></i> Veille Partag√©e
      </a>
      <div>
        <span id="syncStatus" class="me-3">
          <span class="status-indicator status-offline" id="statusDot"></span>
          <small>Hors ligne</small>
        </span>
        <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#shareModal">
          <i class="bi bi-share-fill"></i> Partager
        </button>
      </div>
    </div>
  </nav>

  <div class="container py-5">
    <h1 class="section-title text-center mb-4">üìö Veille Documentaire Collaborative</h1>
    
    <!-- Mode d'emploi -->
    <div class="card-admin p-4 mb-4">
      <h4><i class="bi bi-info-circle"></i> Comment partager cette veille ?</h4>
      <div class="row mt-3">
        <div class="col-md-4">
          <div class="text-center p-3">
            <i class="bi bi-google text-warning" style="font-size: 2rem;"></i>
            <h5 class="mt-2">Google Sheets</h5>
            <p>Copiez vos donn√©es dans un Google Sheet public</p>
            <button class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#sheetsModal">
              Configurer
            </button>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="text-center p-3">
            <i class="bi bi-github text-light" style="font-size: 2rem;"></i>
            <h5 class="mt-2">GitHub Pages</h5>
            <p>H√©bergez cette page gratuitement sur GitHub</p>
            <a href="#github" class="btn btn-outline-light btn-sm">Voir guide</a>
          </div>
        </div>
        
        <div class="col-md-4">
          <div class="text-center p-3">
            <i class="bi bi-file-earmark-text text-info" style="font-size: 2rem;"></i>
            <h5 class="mt-2">Fichier statique</h5>
            <p>Exportez et partagez le fichier HTML complet</p>
            <button onclick="exportCompleteHTML()" class="btn btn-outline-info btn-sm">
              <i class="bi bi-download"></i> T√©l√©charger
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Interface principale (identique √† avant mais avec partage) -->
    <div class="row">
      <div class="col-md-8">
        <div class="card-admin p-4">
          <h4><i class="bi bi-journal-text"></i> Articles r√©cents</h4>
          <div id="articlesList" class="mt-3">
            <!-- Les articles appara√Ætront ici -->
          </div>
        </div>
      </div>
      
      <div class="col-md-4">
        <div class="card-admin p-4">
          <h4><i class="bi bi-gear"></i> Administration</h4>
          <div class="d-grid gap-2 mt-3">
            <button class="btn btn-primary" data-bs-toggle="collapse" data-bs-target="#formCollapse">
              <i class="bi bi-plus-circle"></i> Ajouter un article
            </button>
            <button onclick="exportToJSON()" class="btn btn-outline-light">
              <i class="bi bi-download"></i> Exporter JSON
            </button>
            <button onclick="importFromJSON()" class="btn btn-outline-light">
              <i class="bi bi-upload"></i> Importer JSON
            </button>
            <button onclick="generateShareableLink()" class="btn btn-success">
              <i class="bi bi-link"></i> G√©n√©rer un lien de partage
            </button>
          </div>
          
          <div class="mt-4">
            <h6>Statistiques</h6>
            <p>Articles: <span id="articleCount">0</span></p>
            <p>Derni√®re modification: <span id="lastModified">-</span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulaire d'ajout (collapsible) -->
    <div class="collapse mt-4" id="formCollapse">
      <div class="card-admin p-4">
        <h4>Ajouter un article</h4>
        <!-- Formulaire identique √† la version pr√©c√©dente -->
        <form id="articleForm" class="mt-3">
          <div class="row g-3">
            <div class="col-md-3">
              <input type="date" class="form-control bg-dark text-light" id="date" required>
            </div>
            <div class="col-md-9">
              <input type="text" class="form-control bg-dark text-light" id="titre" placeholder="Titre" required>
            </div>
            <div class="col-12">
              <textarea class="form-control bg-dark text-light" id="resume" rows="2" placeholder="R√©sum√©" required></textarea>
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control bg-dark text-light" id="source" placeholder="Source" required>
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control bg-dark text-light" id="motscles" placeholder="Mots-cl√©s (s√©par√©s par des virgules)" required>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary">Ajouter</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal pour partager via Google Sheets -->
  <div class="modal fade" id="sheetsModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-google"></i> Partage Google Sheets</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ol>
            <li>Cr√©ez un <a href="https://sheets.new" target="_blank" class="text-warning">nouveau Google Sheet</a></li>
            <li>Ajoutez ces en-t√™tes en premi√®re ligne:
              <pre class="bg-black p-2 mt-2">Date,Titre,Source,Lien,Outil,Mots-cl√©s,R√©sum√©,Pays</pre>
            </li>
            <li>Cliquez sur "Partager" ‚Üí "Modifier le lien" ‚Üí "Toute personne avec le lien peut <strong>voir</strong>"</li>
            <li>Copiez l'URL et collez-la ici:</li>
            <input type="text" class="form-control bg-dark text-light mt-2" id="sheetsUrl" placeholder="https://docs.google.com/spreadsheets/d/...">
          </ol>
          <button class="btn btn-warning w-100 mt-3" onclick="setupGoogleSheets()">
            <i class="bi bi-check-circle"></i> Configurer le partage
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal pour g√©n√©rer un lien -->
  <div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-link-45deg"></i> Partager votre veille</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <h6>Option 1: Export complet</h6>
            <p>T√©l√©chargez cette page avec toutes les donn√©es int√©gr√©es :</p>
            <button onclick="exportCompleteHTML()" class="btn btn-outline-info w-100">
              <i class="bi bi-download"></i> T√©l√©charger le fichier HTML complet
            </button>
            <small class="text-muted">Partagez ce fichier par email, Drive, etc.</small>
          </div>
          
          <div class="mb-3">
            <h6>Option 2: Donn√©es seulement</h6>
            <p>Exportez les donn√©es pour les importer ailleurs :</p>
            <button onclick="exportToJSON()" class="btn btn-outline-light w-100 mb-2">JSON</button>
            <button onclick="exportToCSV()" class="btn btn-outline-light w-100">CSV</button>
          </div>
          
          <div>
            <h6>Option 3: H√©bergement gratuit</h6>
            <p>D√©ployez sur GitHub Pages en 5 minutes :</p>
            <a href="#githubGuide" class="btn btn-success w-100">
              <i class="bi bi-github"></i> Voir le guide GitHub
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Donn√©es
    let articles = [];
    
    // Charger depuis le localStorage
    function loadData() {
      const saved = localStorage.getItem('veilleData');
      if (saved) {
        articles = JSON.parse(saved);
        displayArticles();
      }
    }
    
    // Sauvegarder
    function saveData() {
      localStorage.setItem('veilleData', JSON.stringify(articles));
      updateStats();
    }
    
    // Afficher les articles
    function displayArticles() {
      const container = document.getElementById('articlesList');
      if (articles.length === 0) {
        container.innerHTML = '<p class="text-muted">Aucun article pour le moment.</p>';
        return;
      }
      
      let html = '';
      articles.sort((a,b) => new Date(b.date) - new Date(a.date));
      
      articles.slice(0, 10).forEach(article => {
        const tags = article.motscles.split(',').map(t => 
          `<span class="badge-key">${t.trim()}</span>`
        ).join('');
        
        html += `
          <div class="card bg-dark border-secondary mb-3">
            <div class="card-body">
              <h6>${article.titre}</h6>
              <p class="small text-muted mb-2">
                ${article.date} ‚Ä¢ ${article.source} ‚Ä¢ ${article.pays || 'International'}
              </p>
              <p class="mb-2">${article.resume}</p>
              <div class="mb-2">${tags}</div>
              <small class="text-info">${article.outil || ''}</small>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    // G√©rer le formulaire
    document.getElementById('articleForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newArticle = {
        date: document.getElementById('date').value,
        titre: document.getElementById('titre').value,
        source: document.getElementById('source').value,
        lien: document.getElementById('lien')?.value || '',
        outil: document.getElementById('outil')?.value || '',
        motscles: document.getElementById('motscles').value,
        resume: document.getElementById('resume').value,
        pays: document.getElementById('pays')?.value || 'International'
      };
      
      articles.push(newArticle);
      saveData();
      displayArticles();
      this.reset();
      document.getElementById('date').valueAsDate = new Date();
      
      alert('Article ajout√© !');
    });
    
    // Exporter le HTML COMPLET avec les donn√©es int√©gr√©es
    function exportCompleteHTML() {
      // Cr√©er une copie du HTML actuel avec les donn√©es incluses
      const dataBlob = new Blob([`
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Veille Documentaire ‚Äî Nawell Medjahed</title>
  <style>
    /* Copiez tous vos styles CSS ici */
    body { font-family: Arial, sans-serif; background: #f5f5f5; }
    .article { background: white; padding: 15px; margin: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Veille Documentaire ‚Äî Robotique M√©dicale</h1>
  <div id="articles">
    ${articles.map(article => `
      <div class="article">
        <h3>${article.titre}</h3>
        <p><strong>Date:</strong> ${article.date}</p>
        <p><strong>Source:</strong> ${article.source}</p>
        <p>${article.resume}</p>
        <p><strong>Mots-cl√©s:</strong> ${article.motscles}</p>
      </div>
    `).join('')}
  </div>
  <p><em>Export g√©n√©r√© le ${new Date().toLocaleDateString()}</em></p>
</body>
</html>
      `], { type: 'text/html' });
      
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'veille-documentaire-complete.html';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Exporter JSON
    function exportToJSON() {
      const dataStr = JSON.stringify(articles, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'veille-documentaire.json';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Exporter CSV
    function exportToCSV() {
      let csv = 'Date,Titre,Source,Lien,Outil,Mots-cl√©s,R√©sum√©,Pays\\n';
      articles.forEach(article => {
        csv += `"${article.date}","${article.titre}","${article.source}","${article.lien}","${article.outil}","${article.motscles}","${article.resume}","${article.pays}"\\n`;
      });
      
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'veille-documentaire.csv';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Importer JSON
    function importFromJSON() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function() {
          articles = JSON.parse(reader.result);
          saveData();
          displayArticles();
          alert(`${articles.length} articles import√©s !`);
        };
        reader.readAsText(file);
      };
      input.click();
    }
    
    // Mettre √† jour les statistiques
    function updateStats() {
      document.getElementById('articleCount').textContent = articles.length;
      document.getElementById('lastModified').textContent = new Date().toLocaleDateString();
    }
    
    // Initialiser
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
      document.getElementById('date').valueAsDate = new Date();
      updateStats();
    });
  </script>
</body>
</html>
